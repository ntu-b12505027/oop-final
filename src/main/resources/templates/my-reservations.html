<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>æˆ‘çš„é ç´„ - å®¿èˆæ´—è¡£æ©Ÿç®¡ç†ç³»çµ±</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .reservation-header {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .reservation-card {
            transition: transform 0.2s;
            border: none;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .reservation-card:hover {
            transform: translateY(-2px);
        }
        .status-upcoming {
            background: linear-gradient(135deg, #cce5ff 0%, #b3d9ff 100%);
            border-left: 4px solid #007bff;
        }
        .status-in-progress {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border-left: 4px solid #ffc107;
        }
        .status-completed {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border-left: 4px solid #28a745;
        }
        .status-canceled {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            border-left: 4px solid #dc3545;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- æ¨™é¡Œ -->
        <div class="reservation-header text-center">
            <h1 class="mb-0">
                <i class="fas fa-calendar-check me-3"></i>
                ğŸ“‹ æˆ‘çš„é ç´„è¨˜éŒ„
            </h1>
            <p class="mb-0 mt-2">æŸ¥çœ‹å’Œç®¡ç†æ‚¨çš„æ©Ÿå°é ç´„</p>
        </div>
        
        <!-- è¿”å›æŒ‰éˆ• -->
        <div class="text-center mb-4">
            <a href="/" class="btn btn-outline-primary btn-lg">
                <i class="fas fa-arrow-left me-2"></i>è¿”å›ä¸»é 
            </a>
        </div>
		<!-- å­¸è™Ÿç™»å…¥å€åŸŸ -->
		<div class="row mb-4">
		    <div class="col-12">
		        <div class="card">
		            <div class="card-header bg-info text-white">
		                <h5 class="mb-0">
		                    <i class="fas fa-user me-2"></i>ğŸ“ å­¸è™Ÿç™»å…¥
		                </h5>
		            </div>
		            <div class="card-body">
		                <form action="/reservation/my" method="get">
		                    <div class="row align-items-end">
		                        <div class="col-md-8">
		                            <label class="form-label fw-bold">è«‹è¼¸å…¥å­¸è™ŸæŸ¥çœ‹æ‚¨çš„é ç´„è¨˜éŒ„ï¼š</label>
		                            <input type="text" name="studentId" class="form-control" 
		                                   th:value="${currentStudentId}"
		                                   placeholder="ä¾‹å¦‚ï¼šB12345678" required maxlength="15">
		                            <div class="form-text">è¼¸å…¥å®Œæ•´å­¸è™Ÿä»¥æŸ¥çœ‹æ‚¨çš„æ‰€æœ‰é ç´„</div>
		                        </div>
		                        <div class="col-md-4">
		                            <button type="submit" class="btn btn-primary btn-lg w-100">
		                                <i class="fas fa-search me-2"></i>æŸ¥çœ‹æˆ‘çš„é ç´„
		                            </button>
		                        </div>
		                    </div>
		                </form>
		                
		                <!-- ç•¶å‰é¡¯ç¤ºçš„å­¸è™Ÿ -->
		                <div th:if="${currentStudentId}" class="mt-3">
		                    <div class="alert alert-info mb-0">
		                        <i class="fas fa-info-circle me-2"></i>
		                        ç›®å‰é¡¯ç¤ºå­¸è™Ÿï¼š<strong th:text="${currentStudentId}">B12345678</strong> çš„é ç´„è¨˜éŒ„
		                        <a href="/reservation/my" class="btn btn-outline-info btn-sm ms-2">æŸ¥çœ‹å…¨éƒ¨</a>
		                    </div>
		                </div>
		            </div>
		        </div>
		    </div>
		</div>

        <!-- é ç´„çµ±è¨ˆ -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card text-center bg-primary text-white">
                    <div class="card-body">
                        <i class="fas fa-clock fa-2x mb-2"></i>
                        <h4 th:text="${upcomingCount ?: 0}">0</h4>
                        <p class="mb-0">å³å°‡é–‹å§‹</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center bg-warning text-dark">
                    <div class="card-body">
                        <i class="fas fa-play fa-2x mb-2"></i>
                        <h4 th:text="${inProgressCount ?: 0}">0</h4>
                        <p class="mb-0">é€²è¡Œä¸­</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center bg-success text-white">
                    <div class="card-body">
                        <i class="fas fa-check fa-2x mb-2"></i>
                        <h4 th:text="${completedCount ?: 0}">0</h4>
                        <p class="mb-0">å·²å®Œæˆ</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center bg-danger text-white">
                    <div class="card-body">
                        <i class="fas fa-times fa-2x mb-2"></i>
                        <h4 th:text="${canceledCount ?: 0}">0</h4>
                        <p class="mb-0">å·²å–æ¶ˆ</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- é ç´„åˆ—è¡¨ -->
        <div class="row">
            <div class="col-12">
                <!-- æœ‰é ç´„è¨˜éŒ„æ™‚ -->
                <div th:if="${reservations != null and !reservations.isEmpty()}">
                    <div th:each="reservation : ${reservations}">
                        <div class="card reservation-card"
                             th:classappend="${reservation.status.name() == 'UPCOMING'} ? 'status-upcoming' : 
                                            (${reservation.status.name() == 'IN_PROGRESS'} ? 'status-in-progress' : 
                                            (${reservation.status.name() == 'COMPLETED'} ? 'status-completed' : 'status-canceled'))">
                            <div class="card-body">
                                <div class="row align-items-center">
                                    <div class="col-md-8">
                                        <h5 class="card-title">
                                            <i class="fas fa-desktop me-2"></i>
                                            é ç´„ #<span th:text="${reservation.reservationId}">1</span>
                                        </h5>
                                        
                                        <div class="row">
                                            <div class="col-sm-6">
                                                <p class="card-text mb-1">
                                                    <strong>ğŸ”§ æ©Ÿå°IDï¼š</strong>
                                                    <span th:text="${reservation.machineId}">1</span>
                                                </p>
                                                <p class="card-text mb-1">
                                                    <strong>â° é–‹å§‹æ™‚é–“ï¼š</strong>
                                                    <span th:text="${#temporals.format(reservation.startTime, 'MM-dd HH:mm')}">æ™‚é–“</span>
                                                </p>
                                                <p class="card-text mb-1">
                                                    <strong>â±ï¸ çµæŸæ™‚é–“ï¼š</strong>
                                                    <span th:text="${#temporals.format(reservation.endTime, 'MM-dd HH:mm')}">æ™‚é–“</span>
                                                </p>
                                            </div>
                                            <div class="col-sm-6">
                                                <p class="card-text mb-1">
                                                    <strong>ğŸ“… é ç´„æ™‚é–“ï¼š</strong>
                                                    <span th:text="${#temporals.format(reservation.bookingTime, 'MM-dd HH:mm')}">æ™‚é–“</span>
                                                </p>
                                                <p class="card-text mb-1">
                                                    <strong>ğŸ‘¤ ä½¿ç”¨è€…IDï¼š</strong>
                                                    <span th:text="${reservation.userId}">1</span>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-4 text-center">
                                        <!-- ç‹€æ…‹é¡¯ç¤º -->
                                        <div class="mb-3">
                                            <span th:switch="${reservation.status.name()}">
                                                <span th:case="'UPCOMING'" class="badge bg-primary fs-6">
                                                    <i class="fas fa-clock me-1"></i>å³å°‡é–‹å§‹
                                                </span>
                                                <span th:case="'IN_PROGRESS'" class="badge bg-warning fs-6">
                                                    <i class="fas fa-play me-1"></i>é€²è¡Œä¸­
                                                </span>
                                                <span th:case="'COMPLETED'" class="badge bg-success fs-6">
                                                    <i class="fas fa-check me-1"></i>å·²å®Œæˆ
                                                </span>
                                                <span th:case="'CANCELED'" class="badge bg-danger fs-6">
                                                    <i class="fas fa-times me-1"></i>å·²å–æ¶ˆ
                                                </span>
                                            </span>
                                        </div>
                                        
                                        <!-- æ“ä½œæŒ‰éˆ• -->
                                        <div th:if="${reservation.status.name() == 'UPCOMING' or reservation.status.name() == 'IN_PROGRESS'}">
                                            <form th:action="@{/reservation/cancel}" method="post">
                                                <input type="hidden" name="reservationId" th:value="${reservation.reservationId}">
                                                <button type="submit" class="btn btn-outline-danger btn-sm"
                                                        onclick="return confirm('ç¢ºå®šè¦å–æ¶ˆé€™å€‹é ç´„å—ï¼Ÿ')">
                                                    <i class="fas fa-trash me-1"></i>å–æ¶ˆé ç´„
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æ²’æœ‰é ç´„è¨˜éŒ„æ™‚ -->
                <div th:if="${reservations == null or reservations.isEmpty()}" class="text-center">
                    <div class="card">
                        <div class="card-body py-5">
                            <i class="fas fa-calendar-times fa-4x text-muted mb-3"></i>
                            <h4 class="text-muted">é‚„æ²’æœ‰é ç´„è¨˜éŒ„</h4>
                            <p class="text-muted mb-4">æ‚¨ç›®å‰é‚„æ²’æœ‰ä»»ä½•æ©Ÿå°é ç´„è¨˜éŒ„</p>
                            <a href="/" class="btn btn-primary btn-lg">
                                <i class="fas fa-plus me-2"></i>ç«‹å³é ç´„æ©Ÿå°
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- åº•éƒ¨é€£çµ -->
        <div class="text-center mt-5 mb-4">
            <a href="/" class="btn btn-outline-primary me-2">
                <i class="fas fa-home me-2"></i>å›åˆ°ä¸»é 
            </a>
            <a href="/admin" class="btn btn-outline-secondary">
                <i class="fas fa-cog me-2"></i>ç®¡ç†å“¡é¢æ¿
            </a>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
